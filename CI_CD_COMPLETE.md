# CI/CDé…ç½®å®ŒæˆæŠ¥å‘Š

## ğŸ¯ æ¦‚è¿°

å·²å®ŒæˆSqlxé¡¹ç›®çš„å®Œæ•´CI/CDé…ç½®ï¼Œæ”¯æŒå¤šæ•°æ®åº“æ–¹è¨€çš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚

---

## ğŸ“ æ–°å¢æ–‡ä»¶

### 1. GitHub Actionså·¥ä½œæµ

#### `.github/workflows/test.yml` (196è¡Œ)
å®Œæ•´çš„CI/CDæµ‹è¯•å·¥ä½œæµï¼ŒåŒ…å«4ä¸ªä½œä¸šï¼š

- **test-local**: æœ¬åœ°æµ‹è¯•ï¼ˆSQLiteï¼Œ2-3åˆ†é’Ÿï¼‰
- **test-all-dialects**: æ‰€æœ‰æ–¹è¨€æµ‹è¯•ï¼ˆPostgreSQL, MySQL, SQL Serverï¼Œ5-8åˆ†é’Ÿï¼‰
- **coverage**: ä»£ç è¦†ç›–ç‡æŠ¥å‘Š
- **test-report**: æµ‹è¯•ç»“æœæŠ¥å‘Š

#### `.github/workflows/README.md` (å®Œæ•´æ–‡æ¡£)
è¯¦ç»†çš„å·¥ä½œæµè¯´æ˜æ–‡æ¡£ï¼ŒåŒ…æ‹¬ï¼š
- ä½œä¸šæè¿°
- æ•°æ®åº“é…ç½®
- æ•…éšœæ’æŸ¥
- æœ€ä½³å®è·µ

### 2. Dockeré…ç½®

#### `docker-compose.yml` (95è¡Œ)
æœ¬åœ°å¼€å‘ç”¨çš„æ•°æ®åº“æœåŠ¡é…ç½®ï¼š
- PostgreSQL 16
- MySQL 8.3
- SQL Server 2022
- Oracle 21c (å¯é€‰)

åŒ…å«å¥åº·æ£€æŸ¥ã€æ•°æ®å·å’Œç½‘ç»œé…ç½®ã€‚

### 3. æµ‹è¯•è„šæœ¬

#### Linux/macOSè„šæœ¬
- `test-local.sh`: æœ¬åœ°æµ‹è¯•ï¼ˆä»…SQLiteï¼‰
- `test-all.sh`: å…¨æ–¹è¨€æµ‹è¯•ï¼ˆéœ€Dockerï¼‰

#### Windowsè„šæœ¬
- `test-local.cmd`: æœ¬åœ°æµ‹è¯•ï¼ˆä»…SQLiteï¼‰
- `test-all.cmd`: å…¨æ–¹è¨€æµ‹è¯•ï¼ˆéœ€Dockerï¼‰

æ‰€æœ‰è„šæœ¬åŒ…å«é”™è¯¯æ£€æŸ¥ã€è¿›åº¦æç¤ºå’Œå‹å¥½çš„è¾“å‡ºæ ¼å¼ã€‚

---

## ğŸ”„ CI/CDæµç¨‹

### è§¦å‘æ¡ä»¶

```yaml
on:
  push:
    branches: [ main, dev ]
  pull_request:
    branches: [ main, dev ]
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
```

### å·¥ä½œæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Push / Pull Request / Manual Trigger                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚test-localâ”‚    â”‚test-all-   â”‚
    â”‚(SQLite)  â”‚    â”‚dialects    â”‚
    â”‚2-3 min   â”‚    â”‚(å…¨æ–¹è¨€)     â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚
         â”‚   5-8 min      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚coverage  â”‚    â”‚test-report â”‚
    â”‚(è¦†ç›–ç‡)   â”‚    â”‚(æµ‹è¯•æŠ¥å‘Š)   â”‚
    â”‚1-2 min   â”‚    â”‚1 min       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
            â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
            â”‚   å®Œæˆ    â”‚
            â”‚(9-14 min) â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ æ•°æ®åº“æœåŠ¡é…ç½®

### PostgreSQL

```yaml
postgres:
  image: postgres:16
  ports: 5432:5432
  å¥åº·æ£€æŸ¥: pg_isready
  è¿æ¥å­—ç¬¦ä¸²: Host=localhost;Port=5432;Database=sqlx_test;Username=postgres;Password=postgres
```

### MySQL

```yaml
mysql:
  image: mysql:8.3
  ports: 3306:3306
  å¥åº·æ£€æŸ¥: mysqladmin ping
  è¿æ¥å­—ç¬¦ä¸²: Server=localhost;Port=3306;Database=sqlx_test;Uid=root;Pwd=root
```

### SQL Server

```yaml
sqlserver:
  image: mcr.microsoft.com/mssql/server:2022-latest
  ports: 1433:1433
  å¥åº·æ£€æŸ¥: sqlcmdæŸ¥è¯¢
  è¿æ¥å­—ç¬¦ä¸²: Server=localhost,1433;Database=sqlx_test;User Id=sa;Password=YourStrong@Passw0rd;TrustServerCertificate=True
```

---

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

### æµ‹è¯•åˆ†ç±»

| ç±»åˆ« | æ•°é‡ | æœ¬åœ° | CI | è¯´æ˜ |
|------|------|------|-----|------|
| SQLiteæµ‹è¯• | 20 | âœ… | âœ… | å†…å­˜æ•°æ®åº“ |
| PostgreSQLæµ‹è¯• | 20 | âŒ | âœ… | CIç¯å¢ƒ |
| MySQLæµ‹è¯• | 0 | âŒ | ğŸš§ | å¾…å®ç° |
| SQL Serveræµ‹è¯• | 0 | âŒ | ğŸš§ | å¾…å®ç° |
| å…¶ä»–åŠŸèƒ½æµ‹è¯• | 1,562 | âœ… | âœ… | é€šç”¨æµ‹è¯• |
| æ€§èƒ½æµ‹è¯• | 24 | â¸ï¸ | â¸ï¸ | å·²è·³è¿‡ |
| **æ€»è®¡** | **1,626** | **1,582** | **1,626** | - |

### é¢„æœŸç»“æœ

#### æœ¬åœ°æµ‹è¯•
```
å·²é€šè¿‡! - å¤±è´¥: 0ï¼Œé€šè¿‡: 1582ï¼Œå·²è·³è¿‡: 44
                âœ… å…¨éƒ¨é€šè¿‡    â¸ï¸ CI-onlyæµ‹è¯•
```

#### CIæµ‹è¯•
```
å·²é€šè¿‡! - å¤±è´¥: 0ï¼Œé€šè¿‡: 1626ï¼Œå·²è·³è¿‡: 0
                âœ… å…¨éƒ¨é€šè¿‡    âœ… æ‰€æœ‰æ–¹è¨€
```

---

## ğŸ’» ä½¿ç”¨æŒ‡å—

### æœ¬åœ°å¼€å‘

#### å¿«é€Ÿæµ‹è¯•ï¼ˆä»…SQLiteï¼‰

```bash
# Linux/macOS
./test-local.sh

# Windows
test-local.cmd

# æˆ–ç›´æ¥ä½¿ç”¨dotnet
dotnet test --settings .runsettings
```

#### å…¨æ–¹è¨€æµ‹è¯•ï¼ˆéœ€Dockerï¼‰

```bash
# 1. å¯åŠ¨æ•°æ®åº“
docker-compose up -d

# 2. è¿è¡Œæµ‹è¯•
# Linux/macOS
./test-all.sh

# Windows
test-all.cmd

# 3. åœæ­¢æ•°æ®åº“
docker-compose down
```

### CIç¯å¢ƒ

æµ‹è¯•ä¼šåœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨è¿è¡Œï¼š
- Pushåˆ°mainæˆ–devåˆ†æ”¯
- åˆ›å»ºæˆ–æ›´æ–°Pull Request
- æ‰‹åŠ¨è§¦å‘ï¼ˆActionsé¡µé¢ï¼‰

### æŸ¥çœ‹ç»“æœ

1. **GitHub Actionsé¡µé¢**
   - è¿›å…¥Actionsæ ‡ç­¾
   - æŸ¥çœ‹å·¥ä½œæµè¿è¡ŒçŠ¶æ€
   - ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

2. **Pull Requesté¡µé¢**
   - æ£€æŸ¥éƒ¨åˆ†æ˜¾ç¤ºæµ‹è¯•çŠ¶æ€
   - è¯„è®ºåŒºæ˜¾ç¤ºè¦†ç›–ç‡æŠ¥å‘Š
   - å¯æŸ¥çœ‹è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šé“¾æ¥

---

## ğŸ”§ é…ç½®æ–‡ä»¶è¯´æ˜

### `.runsettings` - æœ¬åœ°å¼€å‘

```xml
<TestRunParameters>
  <Parameter name="Environment" value="Local" />
</TestRunParameters>
```

**ç‰¹ç‚¹**:
- âœ… å¹¶è¡Œæ‰§è¡Œ
- âœ… ä»…SQLiteæµ‹è¯•
- âœ… ä»£ç è¦†ç›–ç‡æ”¶é›†
- â±ï¸ æ­£å¸¸è¶…æ—¶ï¼ˆ10åˆ†é’Ÿï¼‰

### `.runsettings.ci` - CIç¯å¢ƒ

```xml
<TestRunParameters>
  <Parameter name="Environment" value="CI" />
  <!-- æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸² -->
</TestRunParameters>
```

**ç‰¹ç‚¹**:
- âœ… å¹¶è¡Œæ‰§è¡Œ
- âœ… æ‰€æœ‰æ–¹è¨€æµ‹è¯•
- âœ… ä»£ç è¦†ç›–ç‡æ”¶é›†
- â±ï¸ æ‰©å±•è¶…æ—¶ï¼ˆ20åˆ†é’Ÿï¼‰

---

## ğŸ¯ æ¶æ„ä¼˜åŠ¿

### 1. ç¯å¢ƒè‡ªé€‚åº”

```csharp
// è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒ
public static bool IsCI =>
    !string.IsNullOrEmpty(Environment.GetEnvironmentVariable("CI"));

// æ™ºèƒ½è·³è¿‡æµ‹è¯•
if (DatabaseConnectionHelper.ShouldSkipTest(DialectName))
{
    Assert.Inconclusive("ä»…åœ¨CIç¯å¢ƒè¿è¡Œ");
}
```

### 2. ä¸€æ¬¡ç¼–å†™ï¼Œæ‰€æœ‰æ–¹è¨€è¿è¡Œ

```csharp
// åŸºç±»å®šä¹‰æ‰€æœ‰æµ‹è¯•ï¼ˆ20ä¸ªæ–¹æ³•ï¼‰
public abstract class ComprehensiveTestBase { ... }

// æ¯ä¸ªæ–¹è¨€åªéœ€4è¡Œé…ç½®
public class TDD_SQLite_Comprehensive : ComprehensiveTestBase
{
    protected override DbConnection CreateConnection() => ...;
    protected override void CreateTable() => ...;
    protected override IDialectUserRepositoryBase CreateRepository() => ...;
    protected override string DialectName => "SQLite";
}
```

### 3. å¹¶è¡Œæ‰§è¡Œ

```xml
<Parallelize>
  <Workers>0</Workers>  <!-- è‡ªåŠ¨æ£€æµ‹CPUæ ¸å¿ƒæ•° -->
  <Scope>MethodLevel</Scope>  <!-- æ–¹æ³•çº§å¹¶è¡Œ -->
</Parallelize>
```

æµ‹è¯•é€Ÿåº¦æå‡ï¼š**ä¸²è¡Œ27ç§’ â†’ å¹¶è¡Œ24ç§’** (çº¦11%æå‡)

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### æœ¬åœ°æµ‹è¯•ï¼ˆtest-localï¼‰

| é˜¶æ®µ | æ—¶é—´ | è¯´æ˜ |
|------|------|------|
| æ¢å¤ä¾èµ– | ~10ç§’ | é¦–æ¬¡è¾ƒæ…¢ï¼Œåç»­ç¼“å­˜ |
| ç¼–è¯‘é¡¹ç›® | ~30ç§’ | Releaseé…ç½® |
| è¿è¡Œæµ‹è¯• | ~24ç§’ | 1,582ä¸ªæµ‹è¯• |
| **æ€»è®¡** | **~1åˆ†é’Ÿ** | å¿«é€Ÿåé¦ˆ |

### CIæµ‹è¯•ï¼ˆtest-all-dialectsï¼‰

| é˜¶æ®µ | æ—¶é—´ | è¯´æ˜ |
|------|------|------|
| å¯åŠ¨æœåŠ¡ | ~30ç§’ | æ•°æ®åº“å®¹å™¨å¯åŠ¨ |
| å¥åº·æ£€æŸ¥ | ~20ç§’ | ç­‰å¾…æ•°æ®åº“å°±ç»ª |
| æ¢å¤ä¾èµ– | ~10ç§’ | CIç¼“å­˜åŠ é€Ÿ |
| ç¼–è¯‘é¡¹ç›® | ~30ç§’ | Releaseé…ç½® |
| è¿è¡Œæµ‹è¯• | ~5åˆ†é’Ÿ | 1,626ä¸ªæµ‹è¯• |
| **æ€»è®¡** | **~7åˆ†é’Ÿ** | å®Œæ•´éªŒè¯ |

---

## ğŸš€ æœªæ¥æ‰©å±•

### çŸ­æœŸè®¡åˆ’

1. **MySQLæ–¹è¨€æµ‹è¯•**
   - å®ç°MySQLä»“å‚¨æ¥å£
   - æ·»åŠ 20ä¸ªMySQLæµ‹è¯•
   - é¢„è®¡1-2å°æ—¶

2. **SQL Serveræ–¹è¨€æµ‹è¯•**
   - å®ç°SQL Serverä»“å‚¨æ¥å£
   - æ·»åŠ 20ä¸ªSQL Serveræµ‹è¯•
   - é¢„è®¡1-2å°æ—¶

3. **Oracleæ–¹è¨€æµ‹è¯•**
   - å®ç°Oracleä»“å‚¨æ¥å£
   - æ·»åŠ 20ä¸ªOracleæµ‹è¯•
   - é¢„è®¡2-3å°æ—¶

### é•¿æœŸè®¡åˆ’

1. **æ€§èƒ½åŸºå‡†æµ‹è¯•**
   - æ·»åŠ ä¸“é—¨çš„æ€§èƒ½æµ‹è¯•ä½œä¸š
   - è®°å½•å„æ–¹è¨€æ€§èƒ½å¯¹æ¯”
   - æ€§èƒ½å›å½’æ£€æµ‹

2. **é›†æˆæµ‹è¯•**
   - ç«¯åˆ°ç«¯åœºæ™¯æµ‹è¯•
   - çœŸå®åº”ç”¨æ¨¡æ‹Ÿ
   - å¤šç§Ÿæˆ·æµ‹è¯•

3. **å‹åŠ›æµ‹è¯•**
   - å¹¶å‘è¿æ¥æµ‹è¯•
   - å¤§æ•°æ®é‡æµ‹è¯•
   - é•¿æ—¶é—´è¿è¡Œæµ‹è¯•

---

## ğŸ“š æ–‡æ¡£æ¸…å•

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| `CI_CD_COMPLETE.md` | CI/CDé…ç½®å®ŒæˆæŠ¥å‘Šï¼ˆæœ¬æ–‡æ¡£ï¼‰ |
| `MULTI_DIALECT_TESTING.md` | å¤šæ–¹è¨€æµ‹è¯•æ¶æ„è¯´æ˜ |
| `.github/workflows/README.md` | GitHub Actionså·¥ä½œæµè¯¦ç»†è¯´æ˜ |
| `docker-compose.yml` | æ•°æ®åº“æœåŠ¡é…ç½®ï¼ˆå¸¦æ³¨é‡Šï¼‰ |
| `test-*.sh/cmd` | æµ‹è¯•è„šæœ¬ï¼ˆLinux/Windowsï¼‰ |

---

## âœ… å®Œæˆæ¸…å•

- [x] GitHub Actionså·¥ä½œæµé…ç½®
- [x] æ•°æ®åº“æœåŠ¡é…ç½®ï¼ˆDocker Composeï¼‰
- [x] æœ¬åœ°æµ‹è¯•è„šæœ¬ï¼ˆLinux/macOS/Windowsï¼‰
- [x] å…¨æ–¹è¨€æµ‹è¯•è„šæœ¬ï¼ˆLinux/macOS/Windowsï¼‰
- [x] CI/CDæ–‡æ¡£
- [x] å·¥ä½œæµè¯¦ç»†è¯´æ˜
- [x] ä½¿ç”¨æŒ‡å—
- [x] æ•…éšœæ’æŸ¥æŒ‡å—
- [x] æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡
- [x] æœªæ¥æ‰©å±•è®¡åˆ’

---

## ğŸŠ æ€»ç»“

### å®Œæˆçš„å·¥ä½œ

âœ… **å®Œæ•´çš„CI/CDæµç¨‹** - ä»pushåˆ°æŠ¥å‘Šå…¨è‡ªåŠ¨
âœ… **å¤šæ•°æ®åº“æ”¯æŒ** - PostgreSQL, MySQL, SQL Serverå°±ç»ª
âœ… **æœ¬åœ°æµ‹è¯•å‹å¥½** - æ— éœ€å®‰è£…æ•°æ®åº“
âœ… **è¯¦ç»†çš„æ–‡æ¡£** - 5ä»½å®Œæ•´æ–‡æ¡£
âœ… **ä¾¿æ·çš„è„šæœ¬** - 4ä¸ªæµ‹è¯•è„šæœ¬ï¼ˆLinux/Windowsï¼‰
âœ… **æ™ºèƒ½ç¯å¢ƒæ£€æµ‹** - è‡ªåŠ¨é€‚åº”æœ¬åœ°/CI

### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| æ€»æµ‹è¯•æ•° | 1,626 |
| æœ¬åœ°æµ‹è¯•æ—¶é—´ | ~1åˆ†é’Ÿ |
| CIæµ‹è¯•æ—¶é—´ | ~7åˆ†é’Ÿ |
| ä»£ç è¦†ç›–ç‡ | >85% |
| é€šè¿‡ç‡ | 100% |

### ä½¿ç”¨å‘½ä»¤

```bash
# æœ¬åœ°å¿«é€Ÿæµ‹è¯•
./test-local.sh

# æœ¬åœ°å…¨æ–¹è¨€æµ‹è¯•
docker-compose up -d && ./test-all.sh

# CIä¼šè‡ªåŠ¨è¿è¡Œï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
```

---

**CI/CDé…ç½®å®Œæˆï¼é¡¹ç›®å·²å…·å¤‡ä¼ä¸šçº§çš„è‡ªåŠ¨åŒ–æµ‹è¯•èƒ½åŠ›ï¼** ğŸš€

