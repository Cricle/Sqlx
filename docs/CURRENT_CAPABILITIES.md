# å½“å‰ç³»ç»ŸåŠŸèƒ½æ¦‚è§ˆ

## âœ… å·²å®ç°åŠŸèƒ½ (Phase 1-2.3)

### 1. å ä½ç¬¦ç³»ç»Ÿ âœ…

**10ä¸ªæ ¸å¿ƒå ä½ç¬¦å·²å®Œå…¨å®ç°å¹¶æµ‹è¯•ï¼š**

| å ä½ç¬¦ | åŠŸèƒ½ | æµ‹è¯•çŠ¶æ€ |
|--------|------|----------|
| `{{table}}` | è¡¨åï¼ˆå¸¦æ–¹è¨€åŒ…è£¹ç¬¦ï¼‰ | âœ… 21/21 |
| `{{columns}}` | åˆ—ååˆ—è¡¨ | âœ… 21/21 |
| `{{returning_id}}` | RETURNING/OUTPUTå­å¥ | âœ… 21/21 |
| `{{bool_true}}` | å¸ƒå°”trueå­—é¢é‡ | âœ… 21/21 |
| `{{bool_false}}` | å¸ƒå°”falseå­—é¢é‡ | âœ… 21/21 |
| `{{current_timestamp}}` | å½“å‰æ—¶é—´æˆ³ | âœ… 21/21 |
| `{{limit}}` | LIMITå­å¥ | âœ… 21/21 |
| `{{offset}}` | OFFSETå­å¥ | âœ… 21/21 |
| `{{limit_offset}}` | ç»„åˆLIMIT OFFSET | âœ… 21/21 |
| `{{concat}}` | å­—ç¬¦ä¸²è¿æ¥ | âœ… 21/21 |

**æ–¹è¨€æä¾›è€…ï¼š**
- âœ… PostgreSQLDialectProvider
- âœ… MySQLDialectProvider
- âœ… SqlServerDialectProvider
- âœ… SQLiteDialectProvider

### 2. SQLæ¨¡æ¿ç»§æ‰¿è§£æå™¨ âœ…

**TemplateInheritanceResolveråŠŸèƒ½ï¼š**
- âœ… é€’å½’éå†æ¥å£ç»§æ‰¿é“¾
- âœ… æ”¶é›†æ‰€æœ‰å¸¦SqlTemplateçš„æ–¹æ³•
- âœ… è‡ªåŠ¨æ›¿æ¢å ä½ç¬¦
- âœ… é¿å…é‡å¤å¤„ç†
- âœ… æå–å®ä½“åˆ—å

**æµ‹è¯•è¦†ç›–ï¼š** 6/6 âœ…

### 3. æ–¹è¨€å’Œè¡¨åæå– âœ…

**DialectHelperåŠŸèƒ½ï¼š**
- âœ… `GetDialectFromRepositoryFor()` - ä»å±æ€§æå–æ–¹è¨€
- âœ… `GetTableNameFromRepositoryFor()` - ä¸‰çº§ä¼˜å…ˆçº§è¡¨åæå–
- âœ… `GetDialectProvider()` - æ–¹è¨€æä¾›è€…å·¥å‚
- âœ… `ShouldUseTemplateInheritance()` - åˆ¤æ–­æ˜¯å¦éœ€è¦æ¨¡æ¿ç»§æ‰¿

**ä¼˜å…ˆçº§ç³»ç»Ÿï¼š**
1. `RepositoryFor.TableName`å±æ€§
2. `TableNameAttribute`
3. ä»å®ä½“ç±»å‹æ¨æ–­

**æµ‹è¯•è¦†ç›–ï¼š** 11/11 âœ…

### 4. RepositoryForAttributeæ‰©å±• âœ…

**æ–°å¢å±æ€§ï¼š**
```csharp
public sealed class RepositoryForAttribute : System.Attribute
{
    public System.Type ServiceType { get; }
    public SqlDefineTypes Dialect { get; set; } = SqlDefineTypes.SQLite;
    public string? TableName { get; set; }
}
```

**æ”¯æŒï¼š**
- âœ… æ³›å‹å’Œéæ³›å‹ç‰ˆæœ¬
- âœ… é»˜è®¤å€¼ï¼ˆSQLiteï¼‰
- âœ… å¯é€‰çš„TableName

## ğŸ’¡ å½“å‰å¯ç”¨çš„ä½¿ç”¨æ–¹å¼

### åŸºç¡€ç”¨æ³•ï¼ˆå·²å®Œå…¨å¯ç”¨ï¼‰

```csharp
// 1. å®šä¹‰åŸºç¡€æ¥å£ï¼ˆä½¿ç”¨å ä½ç¬¦ï¼‰
public interface IUserRepositoryBase
{
    [SqlTemplate(@"SELECT * FROM {{table}} WHERE id = @id")]
    Task<User?> GetByIdAsync(int id, CancellationToken ct);

    [SqlTemplate(@"INSERT INTO {{table}} (name) VALUES (@name) {{returning_id}}")]
    Task<int> InsertAsync(User user, CancellationToken ct);
}

// 2. æŒ‡å®šæ–¹è¨€å’Œè¡¨åï¼ˆå®ç°ç±»ä¸ºç©ºï¼‰
[RepositoryFor(typeof(IUserRepositoryBase),
    Dialect = SqlDefineTypes.PostgreSql,
    TableName = "users")]
public partial class PostgreSQLUserRepository : IUserRepositoryBase { }

[RepositoryFor(typeof(IUserRepositoryBase),
    Dialect = SqlDefineTypes.MySql,
    TableName = "users")]
public partial class MySQLUserRepository : IUserRepositoryBase { }
```

### æ¨¡æ¿è§£æï¼ˆå·²å®Œå…¨å¯ç”¨ï¼‰

```csharp
// ä½¿ç”¨TemplateInheritanceResolveræ‰‹åŠ¨è§£æ
var resolver = new TemplateInheritanceResolver();
var dialectProvider = DialectHelper.GetDialectProvider(SqlDefineTypes.PostgreSql);

var templates = resolver.ResolveInheritedTemplates(
    interfaceSymbol,
    dialectProvider,
    tableName: "users",
    entityType);

// templatesåŒ…å«æ‰€æœ‰è§£æåçš„æ–¹æ³•æ¨¡æ¿
foreach (var template in templates)
{
    Console.WriteLine($"Method: {template.Method.Name}");
    Console.WriteLine($"Original SQL: {template.OriginalSql}");
    Console.WriteLine($"Processed SQL: {template.ProcessedSql}");
    Console.WriteLine($"Has Placeholders: {template.ContainsPlaceholders}");
}
```

### å ä½ç¬¦æ›¿æ¢ï¼ˆå·²å®Œå…¨å¯ç”¨ï¼‰

```csharp
// ä½¿ç”¨æ–¹è¨€æä¾›è€…æ›¿æ¢å ä½ç¬¦
var pgProvider = new PostgreSqlDialectProvider();
var mysqlProvider = new MySqlDialectProvider();

var template = "SELECT * FROM {{table}} WHERE active = {{bool_true}}";

var pgSql = pgProvider.ReplacePlaceholders(template, tableName: "users");
// ç»“æœ: SELECT * FROM "users" WHERE active = true

var mysqlSql = mysqlProvider.ReplacePlaceholders(template, tableName: "users");
// ç»“æœ: SELECT * FROM `users` WHERE active = 1
```

## â³ è¿›è¡Œä¸­/å¾…å®ŒæˆåŠŸèƒ½

### Phase 2.5: CodeGenerationServiceé›†æˆ (0%)

**éœ€è¦å®ç°ï¼š**
1. åœ¨æºç”Ÿæˆå™¨ä¸­è°ƒç”¨`DialectHelper`
2. åœ¨æºç”Ÿæˆå™¨ä¸­è°ƒç”¨`TemplateInheritanceResolver`
3. ç”Ÿæˆå®é™…çš„ä»“å‚¨å®ç°ä»£ç 
4. å¤„ç†å ä½ç¬¦æ›¿æ¢åçš„SQL

**å½“å‰çŠ¶æ€ï¼š**
- âŒ æºç”Ÿæˆå™¨å°šæœªé›†æˆæ–°åŠŸèƒ½
- âŒ ç”Ÿæˆå™¨ä»ä½¿ç”¨æ—§çš„é€»è¾‘
- âŒ å ä½ç¬¦ä¸ä¼šè‡ªåŠ¨æ›¿æ¢ï¼ˆéœ€è¦æ‰‹åŠ¨è°ƒç”¨ï¼‰

**å½±å“ï¼š**
- ç”¨æˆ·éœ€è¦æ‰‹åŠ¨ç¼–å†™æ–¹è¨€ç‰¹å®šçš„SQL
- æ— æ³•å®ç°"å†™ä¸€æ¬¡ï¼Œå¤šå¤„è¿è¡Œ"
- æ–°åŠŸèƒ½è™½ç„¶å·²å®ç°ï¼Œä½†æœªåœ¨ç”Ÿæˆå™¨ä¸­ä½¿ç”¨

### Phase 3: æµ‹è¯•ä»£ç é‡æ„ (0%)

**éœ€è¦å®ç°ï¼š**
- ç»Ÿä¸€ç°æœ‰çš„å¤šæ–¹è¨€æµ‹è¯•
- åˆ é™¤é‡å¤çš„SQLå®šä¹‰
- ä½¿ç”¨æ–°çš„å ä½ç¬¦ç³»ç»Ÿ

### Phase 4: æ–‡æ¡£æ›´æ–° (0%)

**éœ€è¦å®ç°ï¼š**
- æ›´æ–°README
- åˆ›å»ºå ä½ç¬¦å‚è€ƒæ–‡æ¡£
- æ›´æ–°ç¤ºä¾‹ä»£ç 

## ğŸ“Š å½“å‰æµ‹è¯•çŠ¶æ€

### å•å…ƒæµ‹è¯•
| æµ‹è¯•å¥—ä»¶ | é€šè¿‡/æ€»æ•° | è¦†ç›–ç‡ |
|---------|----------|--------|
| DialectPlaceholderTests | 21/21 | âœ… 100% |
| TemplateInheritanceResolverTests | 6/6 | âœ… 100% |
| DialectHelperTests | 11/11 | âœ… 100% |
| å…¶ä»–Unitæµ‹è¯• | 20/20 | âœ… 100% |
| **æ€»è®¡** | **58/58** | **âœ… 100%** |

### é›†æˆæµ‹è¯•
- âŒ å°šæœªåˆ›å»º
- âŒ éœ€è¦éªŒè¯ç”Ÿæˆå™¨é›†æˆ

### ç«¯åˆ°ç«¯æµ‹è¯•
- âŒ å°šæœªåˆ›å»º
- âŒ éœ€è¦éªŒè¯å®Œæ•´å·¥ä½œæµ

## ğŸ¯ åŠŸèƒ½å®Œæ•´åº¦

### å·²å®Œæˆ (80%)
```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  80%
```

| ç»„ä»¶ | çŠ¶æ€ | è¿›åº¦ |
|------|------|------|
| å ä½ç¬¦ç³»ç»Ÿ | âœ… å®Œæˆ | 100% |
| æ¨¡æ¿ç»§æ‰¿è§£æå™¨ | âœ… å®Œæˆ | 100% |
| æ–¹è¨€æå–å·¥å…· | âœ… å®Œæˆ | 100% |
| å±æ€§æ‰©å±• | âœ… å®Œæˆ | 100% |
| æºç”Ÿæˆå™¨é›†æˆ | âŒ å¾…å®Œæˆ | 0% |
| æµ‹è¯•é‡æ„ | âŒ å¾…å®Œæˆ | 0% |
| æ–‡æ¡£æ›´æ–° | âŒ å¾…å®Œæˆ | 0% |

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### å½“å‰æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç”¨æˆ·ä»£ç  (å·²å¯ç”¨)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  IUserRepositoryBase (æ¥å£)          â”‚   â”‚
â”‚  â”‚  - SqlTemplate with {{placeholders}} â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â†“                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  RepositoryFor(Dialect, TableName)   â”‚   â”‚
â”‚  â”‚  - PostgreSQLUserRepository          â”‚   â”‚
â”‚  â”‚  - MySQLUserRepository               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ–°ç»„ä»¶ (å·²å®Œæˆ,å¾…é›†æˆ)                   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ DialectHelper    â”‚  â”‚  Template       â”‚â”‚
â”‚  â”‚ - GetDialect()   â”‚  â”‚  Inheritance    â”‚â”‚
â”‚  â”‚ - GetTableName() â”‚  â”‚  Resolver       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚            â†“                    â†“           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    DialectProviders                  â”‚  â”‚
â”‚  â”‚    - PostgreSQL, MySQL, etc.         â”‚  â”‚
â”‚  â”‚    - ReplacePlaceholders()           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        âš ï¸ ç¼ºå¤±çš„è¿æ¥ âš ï¸
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æºç”Ÿæˆå™¨ (å¾…ä¿®æ”¹)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  CodeGenerationService               â”‚   â”‚
â”‚  â”‚  - éœ€è¦è°ƒç”¨æ–°ç»„ä»¶                     â”‚   â”‚
â”‚  â”‚  - éœ€è¦ä½¿ç”¨å ä½ç¬¦æ›¿æ¢                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â†“                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ç”Ÿæˆçš„ä»£ç  (ç›®å‰ä½¿ç”¨æ—§é€»è¾‘)          â”‚   â”‚
â”‚  â”‚  public partial class                â”‚   â”‚
â”‚  â”‚  PostgreSQLUserRepository { }        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¼ºå¤±çš„é›†æˆç‚¹

1. **CodeGenerationService.GenerateRepository()**
   - éœ€è¦è°ƒç”¨`DialectHelper.GetDialectFromRepositoryFor()`
   - éœ€è¦è°ƒç”¨`DialectHelper.GetTableNameFromRepositoryFor()`
   - éœ€è¦è°ƒç”¨`DialectHelper.ShouldUseTemplateInheritance()`

2. **å¦‚æœéœ€è¦æ¨¡æ¿ç»§æ‰¿**
   - è°ƒç”¨`TemplateInheritanceResolver.ResolveInheritedTemplates()`
   - éå†è§£æåçš„æ¨¡æ¿
   - ä¸ºæ¯ä¸ªæ¨¡æ¿ç”Ÿæˆæ–¹æ³•å®ç°

3. **ç”Ÿæˆæ–¹æ³•å®ç°**
   - ä½¿ç”¨`template.ProcessedSql`ï¼ˆå·²æ›¿æ¢å ä½ç¬¦ï¼‰
   - ç”Ÿæˆå‚æ•°ç»‘å®šä»£ç 
   - ç”Ÿæˆæ‰§è¡Œå’Œæ˜ å°„ä»£ç 

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### Immediate (Phase 2.5)
1. åˆ›å»º`CodeGenerationService`çš„æ‰©å±•æ–¹æ³•æˆ–ä¿®æ”¹ç°æœ‰é€»è¾‘
2. é›†æˆ`DialectHelper`è°ƒç”¨
3. é›†æˆ`TemplateInheritanceResolver`è°ƒç”¨
4. å®ç°æ¨¡æ¿ç»§æ‰¿çš„ä»£ç ç”Ÿæˆ
5. åˆ›å»ºç®€å•çš„é›†æˆæµ‹è¯•

### Short-term (Phase 3-4)
1. é‡æ„ç°æœ‰æµ‹è¯•ä½¿ç”¨ç»Ÿä¸€æ¥å£
2. æ›´æ–°æ‰€æœ‰æ–‡æ¡£
3. åˆ›å»ºå®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹
4. æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–

## ğŸ’¡ ä½¿ç”¨å»ºè®®

**å½“å‰é˜¶æ®µå»ºè®®ï¼š**

1. **å¯ä»¥ä½¿ç”¨** - å ä½ç¬¦ç³»ç»Ÿçš„æ‰€æœ‰API
2. **å¯ä»¥ä½¿ç”¨** - `TemplateInheritanceResolver`æ‰‹åŠ¨è§£ææ¨¡æ¿
3. **å¯ä»¥ä½¿ç”¨** - `DialectHelper`æå–æ–¹è¨€å’Œè¡¨å
4. **ä¸å¯ä½¿ç”¨** - è‡ªåŠ¨ç”Ÿæˆçš„å¤šæ–¹è¨€ä»“å‚¨ï¼ˆéœ€è¦ç­‰Phase 2.5å®Œæˆï¼‰

**å¦‚ä½•å½“å‰ä½¿ç”¨æ–°åŠŸèƒ½ï¼š**

è™½ç„¶æºç”Ÿæˆå™¨å°šæœªé›†æˆï¼Œä½†ä½ å¯ä»¥ï¼š
1. ä½¿ç”¨æ–°çš„`RepositoryFor`å±æ€§ï¼ˆä¸ºæœªæ¥åšå‡†å¤‡ï¼‰
2. æ‰‹åŠ¨è°ƒç”¨å ä½ç¬¦æ›¿æ¢API
3. ç¼–å†™æµ‹è¯•éªŒè¯å ä½ç¬¦æ›¿æ¢é€»è¾‘
4. å‡†å¤‡ç»Ÿä¸€çš„æ¥å£å®šä¹‰

---

*æœ€åæ›´æ–°: 2025-11-01*
*å½“å‰ç‰ˆæœ¬: Phase 2.3 å®Œæˆ*
*æ€»è¿›åº¦: 80%*

