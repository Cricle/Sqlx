# Native AOT æ€§èƒ½æµ‹è¯•ç»“æœ

## æµ‹è¯•ç¯å¢ƒ

- **BenchmarkDotNet**: v0.15.7
- **OS**: Windows 10 (10.0.19045.6466/22H2/2022Update)
- **CPU**: AMD Ryzen 7 5800H with Radeon Graphics 3.20GHz (8 cores, 16 logical)
- **Runtime**: 
  - JIT-Net9: .NET 9.0.8, X64 RyuJIT x86-64-v3
  - NativeAOT-Net9: .NET 9.0.12, X64 NativeAOT x86-64-v3
- **GC**: Concurrent Workstation
- **æµ‹è¯•æ—¥æœŸ**: 2026-02-06

## å•è¡ŒæŸ¥è¯¢ (SelectSingleBenchmark)

### JIT vs Native AOT å¯¹æ¯”

| æ–¹æ³• | Runtime | Mean | Error | StdDev | Ratio | Rank | Allocated | Alloc Ratio |
|------|---------|------|-------|--------|-------|------|-----------|-------------|
| **Sqlx** | **JIT-Net9** | **11.266 Î¼s** | 0.017 Î¼s | 0.063 Î¼s | **1.00** | **1** | - | - |
| Dapper.AOT | JIT-Net9 | 12.020 Î¼s | 0.013 Î¼s | 0.049 Î¼s | 1.07 | 2 | - | - |
| **Sqlx** | **NativeAOT-Net9** | **12.607 Î¼s** | 0.024 Î¼s | 0.086 Î¼s | **1.12** | **3** | - | - |
| Dapper.AOT | NativeAOT-Net9 | 14.184 Î¼s | 0.040 Î¼s | 0.156 Î¼s | 1.26 | 4 | - | - |
| FreeSql | JIT-Net9 | 68.923 Î¼s | 0.071 Î¼s | 0.255 Î¼s | 6.12 | 5 | - | - |

**ç»“è®º**:
- âœ… Sqlx JIT æ¨¡å¼æœ€å¿«
- âœ… Sqlx AOT æ¯” Dapper.AOT AOT å¿« **11.1%**
- âš¡ Sqlx AOT æ¯” JIT æ…¢ **11.9%** (AOT ç¼–è¯‘çš„æ­£å¸¸å¼€é”€)
- âš ï¸ FreeSql ä¸æ”¯æŒ Native AOT

## æ‰¹é‡æŸ¥è¯¢ (SelectListBenchmark)

### Limit = 10

| æ–¹æ³• | Runtime | Mean | Error | StdDev | Ratio | Rank | Allocated | Alloc Ratio |
|------|---------|------|-------|--------|-------|------|-----------|-------------|
| Dapper.AOT | JIT-Net9 | 38.434 Î¼s | 0.061 Î¼s | 0.227 Î¼s | 0.93 | 1 | - | - |
| **Sqlx** | **JIT-Net9** | **41.214 Î¼s** | 0.168 Î¼s | 0.651 Î¼s | **1.00** | **2** | - | - |
| FreeSql | JIT-Net9 | 42.476 Î¼s | 0.061 Î¼s | 0.230 Î¼s | 1.03 | 2 | - | - |
| Dapper.AOT | NativeAOT-Net9 | 42.988 Î¼s | 0.056 Î¼s | 0.215 Î¼s | 1.04 | 2 | - | - |
| **Sqlx** | **NativeAOT-Net9** | **44.214 Î¼s** | 0.070 Î¼s | 0.273 Î¼s | **1.07** | **2** | - | - |

### Limit = 100

| æ–¹æ³• | Runtime | Mean | Error | StdDev | Ratio | Rank | Allocated | Alloc Ratio |
|------|---------|------|-------|--------|-------|------|-----------|-------------|
| FreeSql | JIT-Net9 | 186.161 Î¼s | 0.269 Î¼s | 1.043 Î¼s | 0.83 | 1 | - | - |
| Dapper.AOT | JIT-Net9 | 198.241 Î¼s | 0.203 Î¼s | 0.732 Î¼s | 0.89 | 2 | - | - |
| **Sqlx** | **JIT-Net9** | **223.381 Î¼s** | 1.160 Î¼s | 10.379 Î¼s | **1.00** | **3** | - | - |
| Dapper.AOT | NativeAOT-Net9 | 243.823 Î¼s | 0.320 Î¼s | 1.196 Î¼s | 1.09 | 4 | - | - |
| **Sqlx** | **NativeAOT-Net9** | **261.780 Î¼s** | 0.407 Î¼s | 1.576 Î¼s | **1.17** | **5** | - | - |

### Limit = 1000

| æ–¹æ³• | Runtime | Mean | Error | StdDev | Ratio | Rank | Allocated | Alloc Ratio |
|------|---------|------|-------|--------|-------|------|-----------|-------------|
| FreeSql | JIT-Net9 | 1.599 ms | 0.003 ms | 0.009 ms | 0.79 | 1 | - | - |
| Dapper.AOT | JIT-Net9 | 1.783 ms | 0.002 ms | 0.007 ms | 0.88 | 2 | - | - |
| **Sqlx** | **JIT-Net9** | **2.027 ms** | 0.002 ms | 0.007 ms | **1.00** | **3** | - | - |
| Dapper.AOT | NativeAOT-Net9 | 2.264 ms | 0.004 ms | 0.017 ms | 1.12 | 4 | - | - |
| **Sqlx** | **NativeAOT-Net9** | **2.401 ms** | 0.003 ms | 0.010 ms | **1.18** | **5** | - | - |

## æ€§èƒ½åˆ†æ

### JIT vs AOT æ€§èƒ½å¯¹æ¯”

#### Sqlx æ€§èƒ½å¯¹æ¯”

| æµ‹è¯•åœºæ™¯ | JIT | AOT | AOT vs JIT | æ€§èƒ½å½±å“ |
|---------|-----|-----|-----------|---------|
| å•è¡ŒæŸ¥è¯¢ | 11.266 Î¼s | 12.607 Î¼s | +11.9% | è½»å¾®ä¸‹é™ |
| 10è¡ŒæŸ¥è¯¢ | 41.214 Î¼s | 44.214 Î¼s | +7.3% | è½»å¾®ä¸‹é™ |
| 100è¡ŒæŸ¥è¯¢ | 223.381 Î¼s | 261.780 Î¼s | +17.2% | ä¸­ç­‰ä¸‹é™ |
| 1000è¡ŒæŸ¥è¯¢ | 2.027 ms | 2.401 ms | +18.4% | ä¸­ç­‰ä¸‹é™ |

#### Dapper.AOT æ€§èƒ½å¯¹æ¯”

| æµ‹è¯•åœºæ™¯ | JIT | AOT | AOT vs JIT | æ€§èƒ½å½±å“ |
|---------|-----|-----|-----------|---------|
| å•è¡ŒæŸ¥è¯¢ | 12.020 Î¼s | 14.184 Î¼s | +18.0% | ä¸­ç­‰ä¸‹é™ |
| 10è¡ŒæŸ¥è¯¢ | 38.434 Î¼s | 42.988 Î¼s | +11.8% | è½»å¾®ä¸‹é™ |
| 100è¡ŒæŸ¥è¯¢ | 198.241 Î¼s | 243.823 Î¼s | +23.0% | æ˜¾è‘—ä¸‹é™ |
| 1000è¡ŒæŸ¥è¯¢ | 1.783 ms | 2.264 ms | +27.0% | æ˜¾è‘—ä¸‹é™ |

### Sqlx vs Dapper.AOT (Native AOT æ¨¡å¼)

| æµ‹è¯•åœºæ™¯ | Sqlx AOT | Dapper.AOT AOT | Sqlx ä¼˜åŠ¿ |
|---------|----------|----------------|----------|
| å•è¡ŒæŸ¥è¯¢ | 12.607 Î¼s | 14.184 Î¼s | **âœ… å¿« 11.1%** |
| 10è¡ŒæŸ¥è¯¢ | 44.214 Î¼s | 42.988 Î¼s | æ…¢ 2.9% |
| 100è¡ŒæŸ¥è¯¢ | 261.780 Î¼s | 243.823 Î¼s | æ…¢ 7.4% |
| 1000è¡ŒæŸ¥è¯¢ | 2.401 ms | 2.264 ms | æ…¢ 6.1% |

## å…³é”®å‘ç°

### âœ… Sqlx åœ¨ AOT æ¨¡å¼ä¸‹çš„ä¼˜åŠ¿

1. **å•è¡ŒæŸ¥è¯¢æ€§èƒ½æœ€ä½³**: åœ¨ Native AOT æ¨¡å¼ä¸‹ï¼ŒSqlx æ¯” Dapper.AOT å¿« 11.1%
2. **AOT æ€§èƒ½æŸå¤±è¾ƒå°**: Sqlx çš„ AOT æ€§èƒ½æŸå¤±ï¼ˆ11.9%-18.4%ï¼‰æ¯” Dapper.AOTï¼ˆ18.0%-27.0%ï¼‰æ›´å°
3. **å®Œå…¨æ”¯æŒ Native AOT**: æ— éœ€ä»»ä½•é…ç½®å³å¯åœ¨ AOT æ¨¡å¼ä¸‹è¿è¡Œ
4. **ä»£ç ç”Ÿæˆè´¨é‡é«˜**: ç”Ÿæˆçš„ä»£ç å¯¹ AOT ç¼–è¯‘å™¨å‹å¥½

### ğŸ“Š AOT æ€§èƒ½ç‰¹ç‚¹

1. **å¯åŠ¨æ—¶é—´æ›´å¿«**: Native AOT åº”ç”¨å¯åŠ¨æ—¶é—´æ˜¾è‘—å‡å°‘
2. **å†…å­˜å ç”¨æ›´å°**: AOT ç¼–è¯‘åçš„åº”ç”¨å†…å­˜å ç”¨æ›´ä½
3. **è¿è¡Œæ—¶æ€§èƒ½**: åœ¨æŸäº›åœºæ™¯ä¸‹ç•¥æ…¢äº JITï¼Œä½†å·®è·å¯æ¥å—
4. **é€‚ç”¨åœºæ™¯**: 
   - äº‘åŸç”Ÿåº”ç”¨ï¼ˆå®¹å™¨åŒ–éƒ¨ç½²ï¼‰
   - Serverless å‡½æ•°
   - å‘½ä»¤è¡Œå·¥å…·
   - èµ„æºå—é™ç¯å¢ƒ

### âš ï¸ FreeSql ä¸æ”¯æŒ Native AOT

FreeSql åœ¨ Native AOT æ¨¡å¼ä¸‹æ— æ³•è¿è¡Œï¼Œå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š
```
System.ArgumentException: FreeSql: The Sqlx.Benchmarks.Models.FreeSqlUser type cannot access the constructor
```

è¿™æ˜¯å› ä¸º FreeSql ä¾èµ–åå°„å’ŒåŠ¨æ€ä»£ç ç”Ÿæˆï¼Œä¸ Native AOT çš„é™åˆ¶ä¸å…¼å®¹ã€‚

## æ¨èä½¿ç”¨åœºæ™¯

### ä½¿ç”¨ JIT æ¨¡å¼

- ä¼ ç»Ÿ ASP.NET Core åº”ç”¨
- éœ€è¦æœ€ä½³è¿è¡Œæ—¶æ€§èƒ½
- å¼€å‘å’Œè°ƒè¯•é˜¶æ®µ

### ä½¿ç”¨ Native AOT æ¨¡å¼

- âœ… äº‘åŸç”Ÿåº”ç”¨ï¼ˆå¿«é€Ÿå¯åŠ¨ï¼‰
- âœ… Serverless å‡½æ•°ï¼ˆå†·å¯åŠ¨ä¼˜åŒ–ï¼‰
- âœ… å‘½ä»¤è¡Œå·¥å…·ï¼ˆå°ä½“ç§¯ï¼‰
- âœ… å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆå‡å°‘é•œåƒå¤§å°ï¼‰
- âœ… èµ„æºå—é™ç¯å¢ƒï¼ˆä½å†…å­˜å ç”¨ï¼‰

## æ€»ç»“

1. **Sqlx å®Œå…¨æ”¯æŒ Native AOT**: æ— éœ€ä»»ä½•é…ç½®æˆ–ä»£ç ä¿®æ”¹
2. **AOT æ€§èƒ½æŸå¤±å¯æ¥å—**: 11.9%-18.4% çš„æ€§èƒ½æŸå¤±æ¢æ¥æ›´å¿«çš„å¯åŠ¨å’Œæ›´å°çš„å†…å­˜å ç”¨
3. **å•è¡ŒæŸ¥è¯¢ä¼˜åŠ¿æ˜æ˜¾**: åœ¨ AOT æ¨¡å¼ä¸‹ä»ç„¶æ¯” Dapper.AOT å¿« 11.1%
4. **é€‚åˆäº‘åŸç”Ÿåœºæ™¯**: ç‰¹åˆ«é€‚åˆéœ€è¦å¿«é€Ÿå¯åŠ¨å’Œä½å†…å­˜å ç”¨çš„åœºæ™¯

---

**æµ‹è¯•æ—¥æœŸ**: 2026-02-06
**æµ‹è¯•çŠ¶æ€**: âœ… å®Œæˆ
