<UserControl x:Class="Sqlx.VisualStudio.ToolWindows.SqlxMethodsToolWindowControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800"
             Background="{DynamicResource VsBrush.Window}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 标题栏和搜索 -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5" Background="{DynamicResource VsBrush.CommandBarMenuBackgroundGradient}">
            <TextBlock Text="🔍 Sqlx Methods"
                       FontWeight="Bold"
                       FontSize="14"
                       Foreground="{DynamicResource VsBrush.WindowText}"
                       VerticalAlignment="Center"
                       Margin="5,0"/>
            <TextBox x:Name="SearchBox"
                     Width="200"
                     Margin="10,5,5,5"
                     TextChanged="SearchBox_TextChanged"
                     Background="{DynamicResource VsBrush.SearchBoxBackground}"
                     Foreground="{DynamicResource VsBrush.WindowText}"
                     ToolTip="搜索方法名、类名或SQL内容"/>
            <Button x:Name="RefreshButton"
                    Content="🔄 刷新"
                    Margin="5"
                    Padding="5,2"
                    Click="RefreshButton_Click"
                    Background="{DynamicResource VsBrush.CommandBarMenuBackgroundGradient}"
                    Foreground="{DynamicResource VsBrush.WindowText}"
                    ToolTip="刷新方法列表"/>
        </StackPanel>

        <!-- 方法列表 -->
        <ListView x:Name="MethodsListView"
                  Grid.Row="1"
                  Margin="5"
                  SelectionChanged="MethodsListView_SelectionChanged"
                  MouseDoubleClick="MethodsListView_MouseDoubleClick"
                  Background="{DynamicResource VsBrush.Window}"
                  Foreground="{DynamicResource VsBrush.WindowText}"
                  BorderBrush="{DynamicResource VsBrush.ActiveBorder}">
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Method" Width="150" DisplayMemberBinding="{Binding MethodName}"/>
                    <GridViewColumn Header="Class" Width="120" DisplayMemberBinding="{Binding ClassName}"/>
                    <GridViewColumn Header="Attribute" Width="100" DisplayMemberBinding="{Binding AttributeType}"/>
                    <GridViewColumn Header="SQL Preview" Width="300">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding SqlPreview}"
                                          TextTrimming="CharacterEllipsis"
                                          FontFamily="Consolas"
                                          FontSize="11"
                                          Foreground="{DynamicResource VsBrush.GrayText}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="File" Width="200" DisplayMemberBinding="{Binding FileName}"/>
                </GridView>
            </ListView.View>
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="{DynamicResource VsBrush.Highlight}"/>
                            <Setter Property="Foreground" Value="{DynamicResource VsBrush.HighlightText}"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </ListView.ItemContainerStyle>
        </ListView>

        <!-- 详情面板 -->
        <Expander x:Name="DetailsExpander"
                  Grid.Row="2"
                  Header="Method Details"
                  Margin="5"
                  Background="{DynamicResource VsBrush.CommandBarMenuBackgroundGradient}"
                  Foreground="{DynamicResource VsBrush.WindowText}">
            <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="10">
                    <TextBlock x:Name="MethodSignatureText"
                               FontFamily="Consolas"
                               FontWeight="Bold"
                               Margin="0,5"
                               TextWrapping="Wrap"
                               Foreground="{DynamicResource VsBrush.WindowText}"/>
                    <TextBlock Text="SQL Query:"
                               FontWeight="Bold"
                               Margin="0,10,0,5"
                               Foreground="{DynamicResource VsBrush.WindowText}"/>
                    <TextBox x:Name="SqlQueryText"
                             FontFamily="Consolas"
                             FontSize="11"
                             Margin="0,0,0,10"
                             TextWrapping="Wrap"
                             IsReadOnly="True"
                             Background="{DynamicResource VsBrush.CommandBarMenuBackgroundGradient}"
                             Foreground="{DynamicResource VsBrush.WindowText}"
                             BorderBrush="{DynamicResource VsBrush.ActiveBorder}"/>
                    <TextBlock x:Name="ParametersText"
                               FontFamily="Consolas"
                               FontSize="11"
                               Margin="0,5"
                               TextWrapping="Wrap"
                               Foreground="{DynamicResource VsBrush.GrayText}"/>
                </StackPanel>
            </ScrollViewer>
        </Expander>
    </Grid>
</UserControl>
